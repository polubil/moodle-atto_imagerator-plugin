# moodle-atto_imagenator-plugin

---
Плагин предоставляет возможность сгенерировать иллюстрацию по одному нажатию кнопки в текстовом редакторе **Atto**


## Установка

---

___При первом запуске будет произведена загрузка необходимых библиотек и кеширование модели машинного обучения, поэтому важно, чтобы при первом запуске на диске оставалось хотя-бы 10 гб. свободного места.___

1. Установите плагин: перенесите imagenator.zip в область установки плагина по пути "администрирование" -> "плагины" -> "установка плагинов".
2. Настройте плагин: перейдите по пути "администрирование" -> "плагины" -> "обзор плагинов" -> "imagenator"
   - server_url - ссылка на страницу, куда будет отправляться запрос на генерацию (см пункт ...)
   - width - ширина генерируемой картинки в пикселях. Рекомендуемое значение от 512 до 1024.
   - height - высота генерируемой картинки в пикселях. Рекомендуемое значение от 512 до 1024. 
   - steps - количество шагов ввода/вывода. Минимальное значение - 1, максимальное - 10. Влияет на скорость генерации, поэтому выбирается в зависимости от оборудования. Зачастую, рекомендуется использовать значение 2. 
3. В настройках плагина Atto добавьте строчку imagenator = imagenator.
4. Установите Nvidia CUDA Toolkit (при тестировании использовалась версия 12.1) с https://developer.nvidia.com/cuda-toolkit-archive
5. Установите зависимости для сервера генерации. 
```bash
cd ./api/
python -m venv venv
./venv/Scripts/activate
pip install -r ./requirements.txt
pip install --pre torch --index-url https://download.pytorch.org/whl/nightly/cu121
```
6. Запустите сервер
```bash
py main.py
```
7. При использовании ngrok в консоли будет строка

```bash
"Ingress established at $address"
```
Таким образом, server_url в настройках плагина в Moodle будет $address/picture/generate
8. Все готово к использованию. Можно добавить ресурс в moodle и при использовании редактора Atto появится кнопка плагина. Выделите текст и нажмите на кнопку. Как только картинка сгенерируется, она будет добавлена в текст. 